<main class="page-bg min-h-screen px-6 py-14 text-(--graphite-200)">
  <section class="fade-in mx-auto grid w-full max-w-5xl gap-8">
    <header class="flex flex-col gap-3">
      <span class="text-xs uppercase tracking-[0.24rem] text-(--neon-400)">
        NeoSpend
      </span>
      <h1 class="m-0 text-3xl text-[#f5f8fb] md:text-5xl">Rastreador de Finanças</h1>
      <p class="max-w-[46ch] text-base text-(--graphite-300)">
        Acompanhe entradas e saídas com uma visão clara do seu saldo.
      </p>
    </header>

    <section class="grid gap-6 lg:grid-cols-[1.6fr_1fr]">
      <div class="grid gap-4">
        <section class="grid gap-4 md:grid-cols-3">
          <article class="summary-card">
            <div class="text-xs uppercase tracking-[0.15rem] text-(--graphite-300)">
              Saldo Total
            </div>
            <div class="mt-2 text-3xl font-semibold text-[#f4f7fa]">
              {{ formatCurrency(balanceTotal()) }}
            </div>
            <div class="mt-2 text-xs text-(--graphite-300)">Atualizado agora</div>
          </article>
          <article class="summary-card">
            <div class="text-xs uppercase tracking-[0.15rem] text-(--graphite-300)">
              Receitas
            </div>
            <div class="mt-2 text-3xl font-semibold text-[#f4f7fa]">
              {{ formatCurrency(incomeTotal()) }}
            </div>
            <div class="mt-2 text-xs text-(--graphite-300)">Entradas registradas</div>
          </article>
          <article class="summary-card">
            <div class="text-xs uppercase tracking-[0.15rem] text-(--graphite-300)">
              Despesas
            </div>
            <div class="mt-2 text-3xl font-semibold text-[#f4f7fa]">
              {{ formatCurrency(expenseTotal()) }}
            </div>
            <div class="mt-2 text-xs text-(--graphite-300)">Saídas registradas</div>
          </article>
        </section>

        <section class="summary-card">
          <div class="flex items-center justify-between gap-4">
            <div>
              <div class="text-xs uppercase tracking-[0.15rem] text-(--graphite-300)">
                Barra de Gastos
              </div>
              <div class="mt-2 text-2xl font-semibold text-[#f4f7fa]">
                {{ expenseProgress().toFixed(0) }}% das receitas
              </div>
            </div>
            <div class="text-right text-xs text-(--graphite-300)">
              {{ formatCurrency(expenseTotal()) }}
              <span class="block">de {{ formatCurrency(incomeTotal()) }}</span>
            </div>
          </div>
          <div class="progress-track mt-4">
            <div class="progress-fill" [style.width.%]="expenseProgress()"></div>
          </div>
        </section>
      </div>

      <section class="panel-card">
        <h2 class="mb-4 text-lg text-[#f5f8fb]">Distribuição de Despesas</h2>
        <div class="flex flex-col items-center gap-4">
          <div
            class="donut-chart"
            [style.background]="donutGradient()"
            [class.is-empty]="expenseBreakdown().length === 0"
          ></div>
          <div class="w-full text-sm text-(--graphite-300)">
            @if (expenseBreakdown().length === 0) {
              <p>Nenhuma despesa registrada ainda.</p>
            } @else {
              <div class="grid gap-2">
                @for (item of expenseBreakdown(); track item.category) {
                  <div class="flex items-center justify-between">
                    <span>{{ item.category }}</span>
                    <span class="text-[#f5f8fb]">{{ item.percentage }}%</span>
                  </div>
                }
              </div>
            }
          </div>
        </div>
      </section>
    </section>

    <section class="grid gap-8 lg:grid-cols-[0.9fr_1.1fr]">
      <section class="panel-card">
        <h2 class="mb-5 text-lg text-[#f5f8fb]">
          @if (isEditing()) {
            Editar Transação
          } @else {
            Nova Transação
          }
        </h2>
        <form class="grid gap-4" (submit)="addTransaction($event)">
          <div>
            <label class="text-xs uppercase tracking-[0.12rem] text-(--graphite-300)" for="name">
              Nome
            </label>
            <input
              class="input-field"
              id="name"
              type="text"
              autocomplete="off"
              [value]="name()"
              (input)="name.set($any($event.target).value)"
            />
          </div>
          <div>
            <label class="text-xs uppercase tracking-[0.12rem] text-(--graphite-300)" for="value">
              Valor
            </label>
            <input
              class="input-field"
              id="value"
              type="number"
              step="0.01"
              [value]="valueText()"
              (input)="valueText.set($any($event.target).value)"
            />
            <p class="mt-2 text-xs text-(--graphite-300)">
              Use valor negativo para despesas.
            </p>
          </div>
          <div>
            <label
              class="text-xs uppercase tracking-[0.12rem] text-(--graphite-300)"
              for="category"
            >
              Categoria
            </label>
            <select
              class="input-field"
              id="category"
              [value]="category()"
              (change)="category.set($any($event.target).value)"
            >
              @for (item of categories; track item) {
                <option>{{ item }}</option>
              }
            </select>
          </div>
          <div class="flex flex-wrap justify-end gap-3 pt-1">
            @if (isEditing()) {
              <button class="btn-ghost" type="button" (click)="cancelEdit()">
                Cancelar
              </button>
            }
            <button class="btn-neon" type="submit">
              {{ isEditing() ? 'Salvar' : 'Adicionar' }}
            </button>
          </div>
        </form>
      </section>

      <section class="panel-card">
        <div class="mb-5 flex flex-wrap items-center justify-between gap-3">
          <h2 class="text-lg text-[#f5f8fb]">Últimas Transações</h2>
          <div class="flex flex-wrap gap-3">
            <label class="flex items-center gap-2 text-xs uppercase tracking-[0.12rem] text-(--graphite-300)">
              Categoria
              <select
                class="input-field h-10 min-w-40 py-0"
                [value]="filterCategory()"
                (change)="filterCategory.set($any($event.target).value)"
              >
                <option>Todas</option>
                @for (item of categories; track item) {
                  <option>{{ item }}</option>
                }
              </select>
            </label>
            <label class="flex items-center gap-2 text-xs uppercase tracking-[0.12rem] text-(--graphite-300)">
              Mês
              <select
                class="input-field h-10 min-w-40 py-0"
                [value]="filterMonth()"
                (change)="filterMonth.set($any($event.target).value)"
              >
                <option>Todos</option>
                @for (month of monthOptions(); track month) {
                  <option [value]="month">{{ formatMonthLabel(month) }}</option>
                }
              </select>
            </label>
          </div>
        </div>
        <div class="grid gap-3">
          @if (filteredTransactions().length === 0) {
            <p class="text-sm text-(--graphite-300)">
              Nenhuma transação encontrada para o filtro selecionado.
            </p>
          }
          @for (tx of filteredTransactions(); track tx.id) {
            <article class="transaction-card">
              <div>
                <div class="text-base font-semibold text-[#f5f8fb]">{{ tx.name }}</div>
                <div class="mt-1 text-xs text-(--graphite-300)">
                  @if (tx.amount >= 0) {
                    <span class="badge-in">Receita</span>
                  } @else {
                    <span class="badge-out">Despesa</span>
                  }
                  {{ formatDate(tx.createdAt) }} · {{ tx.category }}
                </div>
              </div>
              <div class="flex flex-col items-end gap-2">
                <div
                  class="text-right text-base font-semibold"
                  [style.color]="tx.amount >= 0 ? 'var(--neon-400)' : 'var(--danger-400)'"
                >
                  {{ formatSigned(tx.amount) }}
                </div>
                <div class="flex gap-2">
                  <button class="action-btn" type="button" (click)="startEdit(tx)">Editar</button>
                  <button class="action-btn action-danger" type="button" (click)="deleteTransaction(tx.id)">
                    Excluir
                  </button>
                </div>
              </div>
            </article>
          }
        </div>
      </section>
    </section>
  </section>
</main>
